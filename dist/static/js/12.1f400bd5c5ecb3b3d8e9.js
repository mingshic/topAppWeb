webpackJsonp([12],{"/Kmk":function(e,t){},NUIb:function(e,t){},Usec:function(e,t){},XfY4:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,i=a("mvHQ"),r=a.n(i),n=a("Z1y9"),c=a("Zrlr"),o=a.n(c),l=a("wxAW"),m=a.n(l),u=function(e){e.preventDefault()},d=function(){function e(t){o()(this,e),this.el=t,this.canvas=document.getElementById(this.el),this.cxt=this.canvas.getContext("2d"),this.stage_info=canvas.getBoundingClientRect(),this.path={beginX:0,beginY:0,endX:0,endY:0}}return m()(e,[{key:"init",value:function(e){var t=this;this.canvas.addEventListener("touchstart",function(e){document.addEventListener("touchstart",u,!1),t.drawBegin(e)}),this.canvas.addEventListener("touchend",function(e){document.addEventListener("touchend",u,!1),t.drawEnd()}),this.clear(e)}},{key:"drawBegin",value:function(e){var t=this;window.getSelection()?window.getSelection().removeAllRanges():document.selection.empty(),this.cxt.strokeStyle="#000",this.cxt.beginPath(),this.cxt.moveTo(e.changedTouches[0].clientX-this.stage_info.left,e.changedTouches[0].clientY-this.stage_info.top),this.path.beginX=e.changedTouches[0].clientX-this.stage_info.left,this.path.beginY=e.changedTouches[0].clientY-this.stage_info.top,canvas.addEventListener("touchmove",function(){t.drawing(event)})}},{key:"drawing",value:function(e){this.cxt.lineTo(e.changedTouches[0].clientX-this.stage_info.left,e.changedTouches[0].clientY-this.stage_info.top),this.path.endX=e.changedTouches[0].clientX-this.stage_info.left,this.path.endY=e.changedTouches[0].clientY-this.stage_info.top,this.cxt.stroke()}},{key:"drawEnd",value:function(){document.removeEventListener("touchstart",u,!1),document.removeEventListener("touchend",u,!1),document.removeEventListener("touchmove",u,!1)}},{key:"clear",value:function(e){this.cxt.clearRect(0,0,300,600)}},{key:"save",value:function(){return canvas.toDataURL("image/png")}}]),e}(),f={props:["queryData"],data:function(){return{form:{imgStrQuestion:""},msg:"Welcome to Your Vue.js App",val:!0,url:""}},mounted:function(){(s=new d("canvas")).init()},methods:{clear:function(){s.clear();this.$emit("change",{popBg:!1})},save:function(){var e=s.save();this.form;this.form.imgStrQuestion=e,this.$emit("search",this.form.imgStrQuestion);this.$emit("change",{popBg:!1})},noKeyword:function(){document.activeElement.blur()}}},v={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"helloView"},[a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"65px"}},[a("canvas",{staticStyle:{width:"100%",border:"1px solid black"},attrs:{id:"canvas"}},[e._v("Canvas画板")]),e._v(" "),a("el-form-item",{staticClass:"searchBtn"},[a("el-button",{on:{click:e.clear}},[e._v("取消")]),e._v(" "),a("el-button",{staticClass:"searchBtnCell",on:{click:e.save}},[e._v("保存")])],1)],1)],1)},staticRenderFns:[]};var h={name:"addSignature",components:{canvasa:a("VU/8")(f,v,!1,function(e){a("/Kmk")},"data-v-3242d602",null).exports},data:function(){return{headerRight:"添加签名",popBg:!1}},props:["queryData"],watch:{},created:function(){},methods:{updatePopBg:function(e){this.popBg=e.popBg},searchData:function(e){this.$emit("searchPro",e)},back:function(e){this.$router.back(-1)}}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"headerView"},[a("div",{staticClass:"headerRight",on:{click:function(t){t.stopPropagation(),e.popBg=!e.popBg}}},[e._v(e._s(e.headerRight))]),e._v(" "),e.popBg?[a("div",{staticClass:"popBg"},[a("canvasa",{attrs:{queryData:e.queryData},on:{change:e.updatePopBg,search:e.searchData}})],1)]:e._e()],2)},staticRenderFns:[]};var g=a("VU/8")(h,p,!1,function(e){a("fHnl")},"data-v-7374350e",null).exports,k=(a("mw3O"),{name:"beforeWorkConfirm",components:{addSignature:g},data:function(){return{addSignatureTit:"添加签名",formData:{caseServiceQuestion:{}},imgStrQuestion:"",searchData:[],caseId:this.$route.query.caseId,workId:this.$route.query.workId,serviceId:this.$route.query.serviceId,serviceType:this.$route.query.serviceType,taskId:this.$route.query.taskId,checked:[{ifY1:!1,ifF1:!1},{ifY2:!1,ifF2:!1},{ifY3:!1,ifF3:!1},{ifY4:!1,ifF4:!1},{ifY5:!1,ifF5:!1},{ifY6:!1,ifF6:!1}]}},created:function(){var e=this;n.a.get("?action=/work/getCaseServiceQuestion&CASE_ID="+this.caseId+"&SERVICE_ID="+this.serviceId+"&SERVICE_TYPE="+this.serviceType).then(function(t){console.log(t),2==e.serviceType?(e.formData.caseServiceQuestion=t.dataService[0],e.imgStrQuestion=t.dataService[0].imgStrQuestion):(e.formData.caseServiceQuestion=t.dataDealService[0],e.imgStrQuestion=t.dataDealService[0].imgStrQuestion),null==e.formData.caseServiceQuestion.serviceTime&&(e.formData.caseServiceQuestion.serviceTime=new Date),1==e.formData.caseServiceQuestion.numberIf1?e.checked[0].ifY1=!0:0==e.formData.caseServiceQuestion.numberIf1&&(e.checked[0].ifF1=!0),1==e.formData.caseServiceQuestion.numberIf2?e.checked[1].ifY2=!0:0==e.formData.caseServiceQuestion.numberIf2&&(e.checked[1].ifF2=!0),1==e.formData.caseServiceQuestion.numberIf3?e.checked[2].ifY3=!0:0==e.formData.caseServiceQuestion.numberIf3&&(e.checked[2].ifF3=!0),1==e.formData.caseServiceQuestion.numberIf4?e.checked[3].ifY4=!0:0==e.formData.caseServiceQuestion.numberIf4&&(e.checked[3].ifF4=!0),1==e.formData.caseServiceQuestion.numberIf5?e.checked[4].ifY5=!0:0==e.formData.caseServiceQuestion.numberIf5&&(e.checked[4].ifF5=!0),1==e.formData.caseServiceQuestion.numberIf6?e.checked[5].ifY6=!0:0==e.formData.caseServiceQuestion.numberIf6&&(e.checked[5].ifF6=!0)})},methods:{signature:function(e){this.formData.caseServiceQuestion.imgStrQuestion=e},changeIfY1:function(e){1==e&&(this.checked[0].ifY1=!0,this.checked[0].ifF1=!1)},changeIfF1:function(e){1==e&&(this.checked[0].ifF1=!0,this.checked[0].ifY1=!1)},changeIfY2:function(e){1==e&&(this.checked[1].ifY2=!0,this.checked[1].ifF2=!1)},changeIfF2:function(e){1==e&&(this.checked[1].ifF2=!0,this.checked[1].ifY2=!1)},changeIfY3:function(e){1==e&&(this.checked[2].ifY3=!0,this.checked[2].ifF3=!1)},changeIfF3:function(e){1==e&&(this.checked[2].ifF3=!0,this.checked[2].ifY3=!1)},changeIfY4:function(e){1==e&&(this.checked[3].ifY4=!0,this.checked[3].ifF4=!1)},changeIfF4:function(e){1==e&&(this.checked[3].ifF4=!0,this.checked[3].ifY4=!1)},changeIfY5:function(e){1==e&&(this.checked[4].ifY5=!0,this.checked[4].ifF5=!1)},changeIfF5:function(e){1==e&&(this.checked[4].ifF5=!0,this.checked[4].ifY5=!1)},changeIfY6:function(e){1==e&&(this.checked[5].ifY6=!0,this.checked[5].ifF6=!1)},changeIfF6:function(e){1==e&&(this.checked[5].ifF6=!0,this.checked[5].ifY6=!1)},submitForm:function(e){var t=this,a=this.$loading({lock:!0,text:"提交中...",spinner:"el-icon-loading",background:"rgba(255, 255, 255, 0.3)"}),s=this;this.$refs[e].validate(function(e){if(e){if(1==t.checked[0].ifY1&&1==t.checked[0].ifF1||0==t.checked[0].ifY1&&0==t.checked[0].ifF1)return a.close(),t.$message({message:"序号1请选择是或者否,不能全选或不选!",type:"warning",center:!0,customClass:"msgdefine"}),!1;if(1==t.checked[1].ifY2&&1==t.checked[1].ifF2||0==t.checked[1].ifY2&&0==t.checked[1].ifF2)return a.close(),t.$message({message:"序号2请选择是或者否,不能全选或不选!",type:"warning",center:!0,customClass:"msgdefine"}),!1;if(1==t.checked[2].ifY3&&1==t.checked[2].ifF3||0==t.checked[2].ifY3&&0==t.checked[2].ifF3)return a.close(),t.$message({message:"序号3请选择是或者否,不能全选或不选!",type:"warning",center:!0,customClass:"msgdefine"}),!1;if(1==t.checked[3].ifY4&&1==t.checked[3].ifF4||0==t.checked[3].ifY4&&0==t.checked[3].ifF4)return a.close(),t.$message({message:"序号4请选择是或者否,不能全选或不选!",type:"warning",center:!0,customClass:"msgdefine"}),!1;if(1==t.checked[4].ifY5&&1==t.checked[4].ifF5||0==t.checked[4].ifY5&&0==t.checked[4].ifF5)return a.close(),t.$message({message:"序号5请选择是或者否,不能全选或不选!",type:"warning",center:!0,customClass:"msgdefine"}),!1;if(1==t.checked[5].ifY6&&1==t.checked[5].ifF6||0==t.checked[5].ifY6&&0==t.checked[5].ifF6)return a.close(),t.$message({message:"序号6请选择是或者否,不能全选或不选!",type:"warning",center:!0,customClass:"msgdefine"}),!1;var i={};i.operationStarttime=t.formData.caseServiceQuestion.operationStarttime,i.operationEndtime=t.formData.caseServiceQuestion.operationEndtime,i.stopStarttime=t.formData.caseServiceQuestion.stopStarttime,i.stopEndtime=t.formData.caseServiceQuestion.stopEndtime,i.lastbackupTime=t.formData.caseServiceQuestion.lastbackupTime,i.beforeLastbackupTime=t.formData.caseServiceQuestion.beforeLastbackupTime,i.backuptestTime=t.formData.caseServiceQuestion.backuptestTime,i.serviceTime=t.formData.caseServiceQuestion.serviceTime,i.imgStrQuestion=t.formData.caseServiceQuestion.imgStrQuestion,i.serviceId=t.serviceId;var c=new URLSearchParams;if(c.append("serviceType",t.serviceType),null!=i.operationStarttime&&0==t.checked[0].ifY1||null!=i.operationEndtime&&0==t.checked[0].ifY1)return a.close(),t.$message({message:"序号1请选择是,取消否!",type:"warning",center:!0,customClass:"msgdefine"}),!1;if(null!=i.stopStarttime&&0==t.checked[1].ifY2||null!=i.stopEndtime&&0==t.checked[1].ifY2)return a.close(),t.$message({message:"序号2请选择是,取消否!",type:"warning",center:!0,customClass:"msgdefine"}),!1;if(null!=i.lastbackupTime&&0==t.checked[2].ifY3)return a.close(),t.$message({message:"序号3请选择是,取消否!",type:"warning",center:!0,customClass:"msgdefine"}),!1;if(null!=i.beforeLastbackupTime&&0==t.checked[4].ifY5)return a.close(),t.$message({message:"序号5请选择是,取消否!",type:"warning",center:!0,customClass:"msgdefine"}),!1;if(null!=i.backuptestTime&&0==t.checked[5].ifY6)return a.close(),t.$message({message:"序号6请选择是,取消否!",type:"warning",center:!0,customClass:"msgdefine"}),!1;1==t.checked[0].ifY1?i.numberIf1=1:i.numberIf1=0,1==t.checked[1].ifY2?i.numberIf2="1":i.numberIf2="0",1==t.checked[2].ifY3?i.numberIf3="1":i.numberIf3="0",1==t.checked[3].ifY4?i.numberIf4="1":i.numberIf4="0",1==t.checked[4].ifY5?i.numberIf5="1":i.numberIf5="0",1==t.checked[5].ifY6?i.numberIf6="1":i.numberIf6="0",c.append("data",r()(i)),console.log(c),n.a.post("?action=/work/submitServiceQuestion",c).then(function(e){if(a.close(),"0"==e.STATUSCODE){t.$message({message:"提交成功",type:"success",center:!0,customClass:"msgdefine"});var i=s.workId,r=s.caseId;setTimeout(function(){s.$router.push({name:"serviceList",query:{caseId:r,workId:i}})},1e3)}else t.$message({message:e.MESSAGE+"发生错误",type:"error",center:!0,customClass:"msgdefine"})})}})}}}),I={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"beforeWorkConfirmView"},[a("div",{staticClass:"attention"},[e._v("为确保用户业务连续性及数据安全，请现场工程师务必就以下事项与用户详细沟通，用户确认后方可开始操作：")]),e._v(" "),a("div",{staticClass:"confirmView"},[a("el-form",{ref:"formData",attrs:{model:e.formData}},[a("el-form-item",[a("div",[e._v("1.用户已将维护窗口安排在业务非高峰时段")]),e._v(" "),a("div",{staticClass:"selectBox"},[a("div",[e._v("是：")]),e._v(" "),a("el-checkbox",{on:{change:e.changeIfY1},model:{value:e.checked[0].ifY1,callback:function(t){e.$set(e.checked[0],"ifY1",t)},expression:"checked[0].ifY1"}}),e._v(" "),a("div",[e._v("操作时间")])],1),e._v(" "),a("el-form-item",{staticStyle:{"margin-bottom":"0.05rem"},attrs:{label:"从："}},[a("el-col",{attrs:{span:15}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择开始时间"},model:{value:e.formData.caseServiceQuestion.operationStarttime,callback:function(t){e.$set(e.formData.caseServiceQuestion,"operationStarttime",t)},expression:"formData.caseServiceQuestion.operationStarttime"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"至："}},[a("el-col",{attrs:{span:15}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择结束时间"},model:{value:e.formData.caseServiceQuestion.operationEndtime,callback:function(t){e.$set(e.formData.caseServiceQuestion,"operationEndtime",t)},expression:"formData.caseServiceQuestion.operationEndtime"}})],1)],1),e._v(" "),a("div",{staticClass:"selectBox"},[a("div",[e._v("否：")]),e._v(" "),a("el-checkbox",{on:{change:e.changeIfF1},model:{value:e.checked[0].ifF1,callback:function(t){e.$set(e.checked[0],"ifF1",t)},expression:"checked[0].ifF1"}})],1)],1),e._v(" "),a("el-form-item",[a("div",[e._v("2.用户已申请停机维护窗口")]),e._v(" "),a("div",{staticClass:"selectBox"},[a("div",[e._v("是：")]),e._v(" "),a("el-checkbox",{on:{change:e.changeIfY2},model:{value:e.checked[1].ifY2,callback:function(t){e.$set(e.checked[1],"ifY2",t)},expression:"checked[1].ifY2"}}),e._v(" "),a("div",[e._v("停机时间")])],1),e._v(" "),a("el-form-item",{staticStyle:{"margin-bottom":"0.05rem"},attrs:{label:"从："}},[a("el-col",{attrs:{span:15}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择开始时间"},model:{value:e.formData.caseServiceQuestion.stopStarttime,callback:function(t){e.$set(e.formData.caseServiceQuestion,"stopStarttime",t)},expression:"formData.caseServiceQuestion.stopStarttime"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"至："}},[a("el-col",{attrs:{span:15}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择结束时间"},model:{value:e.formData.caseServiceQuestion.stopEndtime,callback:function(t){e.$set(e.formData.caseServiceQuestion,"stopEndtime",t)},expression:"formData.caseServiceQuestion.stopEndtime"}})],1)],1),e._v(" "),a("div",{staticClass:"selectBox"},[a("div",[e._v("否：")]),e._v(" "),a("el-checkbox",{on:{change:e.changeIfF2},model:{value:e.checked[1].ifF2,callback:function(t){e.$set(e.checked[1],"ifF2",t)},expression:"checked[1].ifF2"}})],1)],1),e._v(" "),a("el-form-item",[a("div",[e._v("3、对于涉及重启或配置变更的服务实施")]),e._v(" "),a("div",[e._v("用户事先完成了操作系统的备份工作")]),e._v(" "),a("div",{staticClass:"selectBox"},[a("div",[e._v("是：")]),e._v(" "),a("el-checkbox",{on:{change:e.changeIfY3},model:{value:e.checked[2].ifY3,callback:function(t){e.$set(e.checked[2],"ifY3",t)},expression:"checked[2].ifY3"}}),e._v(" "),a("div",[e._v("最近一次备份时间：")])],1),e._v(" "),a("div",{staticClass:"block"},[a("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"请选择时间"},model:{value:e.formData.caseServiceQuestion.lastbackupTime,callback:function(t){e.$set(e.formData.caseServiceQuestion,"lastbackupTime",t)},expression:"formData.caseServiceQuestion.lastbackupTime"}})],1),e._v(" "),a("div",{staticClass:"selectBox"},[a("div",[e._v("否：")]),e._v(" "),a("el-checkbox",{on:{change:e.changeIfF3},model:{value:e.checked[2].ifF3,callback:function(t){e.$set(e.checked[2],"ifF3",t)},expression:"checked[2].ifF3"}})],1)]),e._v(" "),a("el-form-item",[a("div",[e._v("4.服务开始前，用户保留了相关配置信息和文档")]),e._v(" "),a("div",[e._v("用于可能必要的恢复")]),e._v(" "),a("el-form-item",{attrs:{label:"是："}},[a("el-checkbox",{on:{change:e.changeIfY4},model:{value:e.checked[3].ifY4,callback:function(t){e.$set(e.checked[3],"ifY4",t)},expression:"checked[3].ifY4"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"否："}},[a("el-checkbox",{on:{change:e.changeIfF4},model:{value:e.checked[3].ifF4,callback:function(t){e.$set(e.checked[3],"ifF4",t)},expression:"checked[3].ifF4"}})],1)],1),e._v(" "),a("el-form-item",[a("div",[e._v("5.用户在服务开始前完成了业务相关数据备份")]),e._v(" "),a("div",{staticClass:"selectBox"},[a("div",[e._v("是：")]),e._v(" "),a("el-checkbox",{on:{change:e.changeIfY5},model:{value:e.checked[4].ifY5,callback:function(t){e.$set(e.checked[4],"ifY5",t)},expression:"checked[4].ifY5"}}),e._v(" "),a("div",[e._v("最近一次备份时间：")])],1),e._v(" "),a("div",{staticClass:"block"},[a("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"请选择时间"},model:{value:e.formData.caseServiceQuestion.beforeLastbackupTime,callback:function(t){e.$set(e.formData.caseServiceQuestion,"beforeLastbackupTime",t)},expression:"formData.caseServiceQuestion.beforeLastbackupTime"}})],1),e._v(" "),a("div",{staticClass:"selectBox"},[a("div",[e._v("否：")]),e._v(" "),a("el-checkbox",{on:{change:e.changeIfF5},model:{value:e.checked[4].ifF5,callback:function(t){e.$set(e.checked[4],"ifF5",t)},expression:"checked[4].ifF5"}})],1)]),e._v(" "),a("el-form-item",[a("div",[e._v("6.用户针对这些备份做过备份恢复测试")]),e._v(" "),a("div",{staticClass:"selectBox"},[a("div",[e._v("是：")]),e._v(" "),a("el-checkbox",{on:{change:e.changeIfY6},model:{value:e.checked[5].ifY6,callback:function(t){e.$set(e.checked[5],"ifY6",t)},expression:"checked[5].ifY6"}}),e._v(" "),a("div",[e._v("备份测试时间：")])],1),e._v(" "),a("div",{staticClass:"block"},[a("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"请选择时间"},model:{value:e.formData.caseServiceQuestion.backuptestTime,callback:function(t){e.$set(e.formData.caseServiceQuestion,"backuptestTime",t)},expression:"formData.caseServiceQuestion.backuptestTime"}})],1),e._v(" "),a("div",{staticClass:"selectBox"},[a("div",[e._v("否：")]),e._v(" "),a("el-checkbox",{on:{change:e.changeIfF6},model:{value:e.checked[5].ifF6,callback:function(t){e.$set(e.checked[5],"ifF6",t)},expression:"checked[5].ifF6"}})],1)]),e._v(" "),a("div",{staticStyle:{margin:"0 0.1rem"}},[e._v("神州数码工程师已按规范要求就本次服务内容、影响和风险与用户进行了沟通，同意神州数码工程师开始服务实施。")]),e._v(" "),a("div",{staticStyle:{margin:"0.1rem"}},[e._v("用户确认")]),e._v(" "),e.formData.caseServiceQuestion.imgStrQuestion?a("div",[a("img",{staticStyle:{height:"1.5rem"},attrs:{id:"imgStrQuestion",src:e.formData.caseServiceQuestion.imgStrQuestion,alt:""}})]):a("div",[a("img",{staticStyle:{height:"0.5rem"},attrs:{src:"",alt:""}})]),e._v(" "),a("add-signature",{attrs:{title:e.addSignatureTit,queryData:e.searchData},on:{searchPro:e.signature}}),e._v(" "),a("el-form-item",{attrs:{label:"日期："}},[a("el-col",{attrs:{span:15}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"请选择时间"},model:{value:e.formData.caseServiceQuestion.serviceTime,callback:function(t){e.$set(e.formData.caseServiceQuestion,"serviceTime",t)},expression:"formData.caseServiceQuestion.serviceTime"}})],1)],1),e._v(" "),a("div",{staticStyle:{height:"0.6rem"}}),e._v(" "),e.imgStrQuestion?e._e():a("el-form-item",{staticClass:"serviceSubmitBtn"},[a("el-button",{on:{click:function(t){e.submitForm("formData")}}},[e._v("提交")])],1)],1)],1)])},staticRenderFns:[]};var y=a("VU/8")(k,I,!1,function(e){a("Usec")},"data-v-4ffabddc",null).exports,_={name:"endSummaryView",components:{},data:function(){return{formData:{userAndPrjItem:"",serviceType:"",workResult:""},workResultInfo:"",workResultArr:[],serviceTypeArr:[],content:"工作内容",result:"工作结果",activeName:"second",workId:this.$route.query.workId,caseId:this.$route.query.caseId,taskId:this.$route.query.taskId,serviceId:this.$route.query.serviceId,serviceType:this.$route.query.serviceType}},created:function(){var e=this;2==this.serviceType?(n.a.get("?action=/work/GetOnsiteServiceFormInfo&CASE_ID="+this.$route.query.caseId+"&SERVICE_ID="+this.$route.query.serviceId).then(function(t){console.log(t),e.formData.userAndPrjItem=t.DATA[0],e.workResultInfo=t.DATA[0].workResult}),n.a.get("?action=/system/getDict2&DICT_TYPE=NT_SERVICE_TYPE","").then(function(t){console.log(t),e.serviceTypeArr=t.data}),n.a.get("?action=/system/getDict2&DICT_TYPE=NT_CASE_WORK_RESULT","").then(function(t){console.log(t),e.workResultArr=t.data})):n.a.get("?action=/work/GetCaseroubleShootingServiceFormInfo&CASE_ID="+this.$route.query.caseId+"&SERVICE_ID="+this.$route.query.serviceId).then(function(t){console.log(t),e.formData.userAndPrjItem=t.DATA[0],e.workResultInfo=t.DATA[0].implementResult})},methods:{check:function(e){return console.log(this.formData.serviceType),null==this.formData.serviceType&&2==this.serviceType?(this.$message({message:"请选择服务类型!",type:"warning",center:!0,customClass:"msgdefine"}),e.close(),!1):null==this.formData.userAndPrjItem.arriveTime?(this.$message({message:"请填写到场时间!",type:"warning",center:!0,customClass:"msgdefine"}),e.close(),!1):null==this.formData.userAndPrjItem.leaveTime?(this.$message({message:"请填写离场时间!",type:"warning",center:!0,customClass:"msgdefine"}),e.close(),!1):null==this.formData.userAndPrjItem.realWork&&2==this.serviceType?(this.$message({message:"请填写实际工时!",type:"warning",center:!0,customClass:"msgdefine"}),e.close(),!1):null==this.formData.workResult&&2==this.serviceType?(this.$message({message:"请填写工作结果!",type:"warning",center:!0,customClass:"msgdefine"}),e.close(),!1):null==this.formData.userAndPrjItem.workContent&&2==this.serviceType?(this.$message({message:"请填写工作内容!",type:"warning",center:!0,customClass:"msgdefine"}),e.close(),!1):null==this.formData.userAndPrjItem.problemPlan&&2==this.serviceType?(this.$message({message:"请填写存在问题!",type:"warning",center:!0,customClass:"msgdefine"}),e.close(),!1):null==this.formData.userAndPrjItem.faultDesc&&1==this.serviceType?(this.$message({message:"请选择工作结果!",type:"warning",center:!0,customClass:"msgdefine"}),e.close(),!1):null==this.formData.userAndPrjItem.analysis&&1==this.serviceType?(this.$message({message:"请填写分析诊断!",type:"warning",center:!0,customClass:"msgdefine"}),e.close(),!1):null==this.formData.userAndPrjItem.implementResult&&1==this.serviceType?(this.$message({message:"请填写实施结果!",type:"warning",center:!0,customClass:"msgdefine"}),e.close(),!1):null!=this.formData.userAndPrjItem.problemSuggest||1!=this.serviceType||(this.$message({message:"请填写遗留问题及建议!",type:"warning",center:!0,customClass:"msgdefine"}),e.close(),!1)},submitForm:function(e){var t=this,a=this.$loading({lock:!0,text:"提交中...",spinner:"el-icon-loading",background:"rgba(255, 255, 255, 0.3)"}),s=this;this.$refs[e].validate(function(e){if(e){if(!s.check(a))return;var i=new URLSearchParams;i.append("serviceId",t.formData.userAndPrjItem.serviceId),i.append("opFlg",1),i.append("customerId",t.formData.userAndPrjItem.customerId);var c={};c.serviceId=t.formData.userAndPrjItem.serviceId,c.caseId=t.caseId,2==s.serviceType?(c.serviceType=t.formData.serviceType,c.realWork=t.formData.userAndPrjItem.realWork,c.workContent=t.formData.userAndPrjItem.workContent,c.workResult=t.formData.workResult,c.problemPlan=t.formData.userAndPrjItem.problemPlan):(c.faultDesc=t.formData.userAndPrjItem.faultDesc,c.analysis=t.formData.userAndPrjItem.analysis,c.implementResult=t.formData.userAndPrjItem.implementResult,c.problemSuggest=t.formData.userAndPrjItem.problemSuggest),c.arriveTime=t.formData.userAndPrjItem.arriveTime,c.leaveTime=t.formData.userAndPrjItem.leaveTime,console.log(c),i.append("data",r()(c)),console.log(i);var o=s.workId,l=s.caseId,m=s.taskId;2==s.serviceType?n.a.post("?action=/work/UpdateSceneServiceFormInfo",i).then(function(e){console.log(e),a.close(),"0"==e.STATUSCODE?(t.$message({message:"提交成功",type:"success",center:!0,customClass:"msgdefine"}),setTimeout(function(){s.$router.push({name:"serviceList",query:{caseId:l,workId:o,taskId:m}})},1e3)):t.$message({message:e.MESSAGE+"发生错误",type:"error",center:!0,customClass:"msgdefine"})}):n.a.post("?action=/work/UpdateCaseTroubleShootingServiceFormInfo",i).then(function(e){console.log(e),a.close(),"0"==e.STATUSCODE?(t.$message({message:"提交成功",type:"success",center:!0,customClass:"msgdefine"}),setTimeout(function(){s.$router.push({name:"serviceList",query:{caseId:l,workId:o,taskId:m}})},1e3)):t.$message({message:e.MESSAGE+"发生错误",type:"error",center:!0,customClass:"msgdefine"})})}})}}},D={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"endSummaryView"},[a("div",{staticClass:"serviceInfoCell"},[a("div",{staticClass:"serviceInfoTit"},[e._v("用户及项目信息")]),e._v(" "),a("div",{staticClass:"serviceContent"},[a("el-form",{ref:"formData",attrs:{model:e.formData}},[a("ul",{staticClass:"tableTd"},[a("li",[a("span",[e._v("服务单号")]),e._v(" "),a("span",[e._v(e._s(e.formData.userAndPrjItem.serviceCd))])]),e._v(" "),a("li",[a("span",[e._v("项目编号")]),e._v(" "),a("span",[e._v(e._s(e.formData.userAndPrjItem.projectCode))])]),e._v(" "),a("li",[a("span",[e._v("项目名称")]),e._v(" "),a("span",[e._v(e._s(e.formData.userAndPrjItem.projectName))])]),e._v(" "),a("li",[a("span",[e._v("用户单位")]),e._v(" "),a("span",[e._v(e._s(e.formData.userAndPrjItem.customerName))])]),e._v(" "),a("li",[a("span",[e._v("联系人")]),e._v(" "),a("span",[e._v(e._s(e.formData.userAndPrjItem.realname))])]),e._v(" "),a("li",[a("span",[e._v("联系电话")]),e._v(" "),a("span",[e._v(e._s(e.formData.userAndPrjItem.contactMobile))])]),e._v(" "),a("li",[a("span",[e._v("事件编号")]),e._v(" "),a("span",[e._v(e._s(e.formData.userAndPrjItem.caseCd))])]),e._v(" "),2==e.serviceType?a("li",[a("span",[e._v("工程师姓名")]),e._v(" "),a("span",[e._v(e._s(e.formData.userAndPrjItem.enginnername))])]):e._e()]),e._v(" "),2==e.serviceType?a("el-form-item",{attrs:{label:"服务类型"}},[a("el-col",{attrs:{span:15}},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择服务类型"},model:{value:e.formData.serviceType,callback:function(t){e.$set(e.formData,"serviceType",t)},expression:"formData.serviceType"}},e._l(e.serviceTypeArr,function(e){return a("el-option",{key:e.value,attrs:{label:e.DICTNAME,value:e.DICTID}})}))],1)],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"到场时间"}},[a("el-col",{attrs:{span:15}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"请选择时间"},model:{value:e.formData.userAndPrjItem.arriveTime,callback:function(t){e.$set(e.formData.userAndPrjItem,"arriveTime",t)},expression:"formData.userAndPrjItem.arriveTime"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"离场时间"}},[a("el-col",{attrs:{span:15}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"请选择时间"},model:{value:e.formData.userAndPrjItem.leaveTime,callback:function(t){e.$set(e.formData.userAndPrjItem,"leaveTime",t)},expression:"formData.userAndPrjItem.leaveTime"}})],1)],1),e._v(" "),2==e.serviceType?a("div",[a("el-form-item",{attrs:{label:"实际实用工时"}},[a("el-col",{attrs:{span:12}},[a("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入使用工时"},model:{value:e.formData.userAndPrjItem.realWork,callback:function(t){e.$set(e.formData.userAndPrjItem,"realWork",t)},expression:"formData.userAndPrjItem.realWork"}})],1)],1),e._v(" "),a("div",{staticClass:"article"},[e._v(e._s(e.content))]),e._v(" "),a("el-form-item",[a("el-input",{attrs:{type:"textarea",placeholder:"请输入工作内容"},model:{value:e.formData.userAndPrjItem.workContent,callback:function(t){e.$set(e.formData.userAndPrjItem,"workContent",t)},expression:"formData.userAndPrjItem.workContent"}})],1),e._v(" "),a("div",{staticClass:"article"},[e._v(e._s(e.result))]),e._v(" "),a("el-form-item",e._l(e.workResultArr,function(t){return a("el-radio-group",{key:t.id,model:{value:e.formData.workResult,callback:function(t){e.$set(e.formData,"workResult",t)},expression:"formData.workResult"}},[a("el-radio",{staticStyle:{width:"100%","margin-left":"0.25rem"},attrs:{label:t.DICTID}},[e._v(e._s(t.DICTNAME))])],1)})),e._v(" "),a("el-form-item",[a("el-input",{attrs:{type:"textarea",placeholder:"若存在问题及下一步计划：若顺利完成，则此项填无"},model:{value:e.formData.userAndPrjItem.problemPlan,callback:function(t){e.$set(e.formData.userAndPrjItem,"problemPlan",t)},expression:"formData.userAndPrjItem.problemPlan"}})],1)],1):a("div",[a("el-form-item",{attrs:{label:"故障现象"}},[a("el-input",{attrs:{placeholder:"请输入故障现象"},model:{value:e.formData.userAndPrjItem.faultDesc,callback:function(t){e.$set(e.formData.userAndPrjItem,"faultDesc",t)},expression:"formData.userAndPrjItem.faultDesc"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"分析诊断"}},[a("el-input",{attrs:{placeholder:"请输入分析诊断"},model:{value:e.formData.userAndPrjItem.analysis,callback:function(t){e.$set(e.formData.userAndPrjItem,"analysis",t)},expression:"formData.userAndPrjItem.analysis"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"实施结果"}},[a("el-input",{attrs:{placeholder:"请输入实施结果"},model:{value:e.formData.userAndPrjItem.implementResult,callback:function(t){e.$set(e.formData.userAndPrjItem,"implementResult",t)},expression:"formData.userAndPrjItem.implementResult"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"遗留问题及建议"}},[a("el-input",{attrs:{placeholder:"请输入遗留问题及建议"},model:{value:e.formData.userAndPrjItem.problemSuggest,callback:function(t){e.$set(e.formData.userAndPrjItem,"problemSuggest",t)},expression:"formData.userAndPrjItem.problemSuggest"}})],1)],1),e._v(" "),a("div",{staticStyle:{height:"0.6rem"}}),e._v(" "),e.workResultInfo?e._e():a("el-form-item",{staticClass:"serviceSubmitBtn"},[a("el-button",{on:{click:function(t){e.submitForm("formData")}}},[e._v("提交")])],1)],1)],1)])])},staticRenderFns:[]};var S=a("VU/8")(_,D,!1,function(e){a("x5rw")},"data-v-bffdf4f0",null).exports,b={name:"customerEditRate",components:{addSignature:g},data:function(){return{addSignatureTit:"添加签名",searchData:[],formData:{optionOption:[],question:[],scoreOption:[],data:"",aroptschked:[],otherResult:""},score:[],evaluateval:[],scoreOption:[],signImg:"",activeName:"third",workId:this.$route.query.workId,caseId:this.$route.query.caseId,evaluateId:this.$route.query.evaluateId,serviceType:this.$route.query.serviceType,serviceId:this.$route.query.serviceId,taskId:this.$route.query.taskId}},created:function(){var e=this,t=this;console.log(this.evaluateId),n.a.get("?action=/work/GetClientReview&evaluateId="+this.evaluateId+"&serviceType="+this.serviceType).then(function(a){if(console.log(a),console.log("aaaaa"),"0"==a.STATUSCODE){e.scoreOption=a.scoreOption;var s=a;e.formData.data=a.DATA[0],e.signImg=a.DATA[0].imgStr;var i=[];s.question.forEach(function(e,a,r){var n={};n.question=e,n.options=s.optionOption.filter(function(t){return e.questionId==t.questionId}),n.chkedopts=n.options.filter(function(e){return e.checkFlg}),n.aroptschked=n.chkedopts.map(function(e,t,a){return e.optionId}),n.scoreval=t.getScore(s.scoreOption,e.questionId),i.push(n)}),e.evaluateval=i,console.log("1111111"),console.log(e.evaluateval)}})},methods:{signature:function(e){this.formData.data.imgStr=e},getScore:function(e,t){var a=0;return e.forEach(function(e,s,i){e.questionId==t&&1==e.checkFlg&&a<e.optionScore&&(a=e.optionScore)}),a},getScoreOpinionId:function(e,t,a){var s=void 0;return e.forEach(function(e,i,r){if(e.questionId==t&&e.optionScore==a)return s=e.optionId,!1}),s},submitForm:function(e){var t=this,a=this.$loading({lock:!0,text:"提交中...",spinner:"el-icon-loading",background:"rgba(255, 255, 255, 0.3)"}),s=this;this.$refs[e].validate(function(e){if(e){if(2==s.serviceType&&!s.check(a))return;var i=new Array,c=0,o=0,l=0,m=0;if(s.evaluateval.forEach(function(e,t,r){var n=e.options;if(e.question.questionComment2){if(!(e.scoreval>0))return m=1,s.$message({message:"请给相关项打分",type:"warning",center:!0,customClass:"msgdefine"}),a.close(),!1;c+=e.scoreval,l+=1,e.scoreval<3&&(o=1);var u=s.getScoreOpinionId(s.scoreOption,e.question.questionId,e.scoreval),d={};d.evaluateId=s.evaluateId,d.questionId=e.question.questionId,d.optionId=u,i.push(d)}if(e.aroptschked.forEach(function(e,t,a){n.forEach(function(t,a,r){if(t.optionId==e){var n={};n.evaluateId=s.evaluateId,n.questionId=t.questionId,n.optionId=e,i.push(n)}})}),s.formData.otherResult&&null==e.question.questionComment2){var f={};f.evaluateId=s.evaluateId,f.questionId=e.question.questionId,f.otherResult=s.formData.otherResult,i.push(f)}}),m)return void a.close();if(!s.formData.data.imgStr)return s.$message({message:"请签名",type:"warning",center:!0,customClass:"msgdefine"}),void a.close();var u=c/l,d=new URLSearchParams;d.append("workId",s.workId),d.append("evaluateStatus",2),d.append("evaluateId",s.evaluateId),d.append("totalScore",u),d.append("EvaluateResult",r()(i)),d.append("failFlg",o),d.append("workId",s.workId),n.a.post("?action=/work/SubmitClientReview",d).then(function(e){console.log(e),a.close(),"0"==e.STATUSCODE?s.updateServiceWithSignature(a):t.$message({message:e.MESSAGE+"发生错误",type:"error",center:!0,customClass:"msgdefine"})})}})},updateServiceWithSignature:function(e){var t=this,a=this,s=new URLSearchParams;s.append("opFlg",5),s.append("customerId",this.formData.data.customerId);var i={};i.serviceId=this.formData.data.serviceId,i.caseId=this.caseId,2==this.serviceType?(i.serviceType=this.serviceType,i.realWork=this.formData.data.realWork,i.workContent=this.formData.data.workContent,i.workResult=this.formData.data.workResult,i.problemPlan=this.formData.data.problemPlan):(i.faultDesc=this.formData.data.faultDesc,i.analysis=this.formData.data.analysis,i.implementResult=this.formData.data.implementResult,i.problemSuggest=this.formData.data.problemSuggest),i.arriveTime=this.formData.data.arriveTime,i.leaveTime=this.formData.data.leaveTime,i.imgStr=this.formData.data.imgStr,i.engineer=localStorage.getItem("empId"),s.append("data",r()(i));var c=this.workId,o=this.caseId,l=this.taskId;2==this.serviceType?n.a.post("?action=/work/UpdateSceneServiceFormInfo",s).then(function(s){e.close(),console.log(s),"0"==s.STATUSCODE?(t.$message({message:"提交成功",type:"success",center:!0,customClass:"msgdefine"}),setTimeout(function(){a.$router.push({name:"serviceList",query:{caseId:o,workId:c,taskId:l}})},1e3)):t.$message({message:s.MESSAGE+"发生错误",type:"error",center:!0,customClass:"msgdefine"})}):n.a.post("?action=/work/UpdateCaseTroubleShootingServiceFormInfo",s).then(function(s){e.close(),console.log(s),"0"==s.STATUSCODE?(t.$message({message:"提交成功",type:"success",center:!0,customClass:"msgdefine"}),setTimeout(function(){a.$router.push({name:"serviceList",query:{caseId:o,workId:c,taskId:l}})},1e3)):t.$message({message:s.MESSAGE+"发生错误",type:"error",center:!0,customClass:"msgdefine"})})},check:function(e){return null==this.formData.data.serviceType?(this.$message({message:"请选择服务类型!",type:"warning",center:!0,customClass:"msgdefine"}),e.close(),!1):null==this.formData.data.arriveTime?(this.$message({message:"请填写到场时间!",type:"warning",center:!0,customClass:"msgdefine"}),e.close(),!1):null==this.formData.data.leaveTime?(this.$message({message:"请填写离场时间!",type:"warning",center:!0,customClass:"msgdefine"}),e.close(),!1):null==this.formData.data.realWork?(this.$message({message:"请填写实际工时!",type:"warning",center:!0,customClass:"msgdefine"}),e.close(),!1):null==this.formData.data.workContent?(this.$message({message:"请填写工作内容!",type:"warning",center:!0,customClass:"msgdefine"}),e.close(),!1):null==this.formData.data.workResult?(this.$message({message:"请选择工作结果!",type:"warning",center:!0,customClass:"msgdefine"}),e.close(),!1):null!=this.formData.data.problemPlan||(this.$message({message:"请填写存在问题!",type:"warning",center:!0,customClass:"msgdefine"}),e.close(),!1)}}},T={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"customerEditRateView"},[a("div",{staticClass:"serviceInfoCell"},[a("div",{staticClass:"serviceContent"},[a("el-form",{ref:"formData",attrs:{model:e.formData}},[e._l(e.evaluateval,function(t,s){return a("div",{key:s,staticClass:"editorView"},[a("el-form-item",[a("div",{staticClass:"star"},[a("span",{staticClass:"starTit"},[e._v(e._s(s+1)+"."+e._s(t.question.questionComment))]),e._v(" "),t.question.questionComment2?a("el-rate",{model:{value:t.scoreval,callback:function(a){e.$set(t,"scoreval",a)},expression:"item.scoreval"}}):e._e()],1)]),e._v(" "),t.scoreval<4&&t.question.questionComment2?a("div",{staticClass:"improve"},[a("span",[e._v(e._s(t.question.questionComment2))]),e._v(" "),a("div",{staticClass:"improveCell"},[a("el-form-item",[a("el-checkbox-group",{model:{value:t.aroptschked,callback:function(a){e.$set(t,"aroptschked",a)},expression:"item.aroptschked"}},e._l(t.options,function(t){return a("el-checkbox",{key:t.optionId,attrs:{label:t.optionId}},[e._v(e._s(t.optionComment))])}))],1)],1)]):null==t.question.questionComment2?a("el-form-item",[a("el-input",{attrs:{type:"textarea",placeholder:"请输入其他想法和建议"},model:{value:e.formData.otherResult,callback:function(t){e.$set(e.formData,"otherResult",t)},expression:"formData.otherResult"}})],1):e._e()],1)}),e._v(" "),a("div",{staticStyle:{margin:"0.1rem"}},[e._v("客户签名")]),e._v(" "),e.formData.data.imgStr?a("div",[a("img",{staticStyle:{height:"1.5rem"},attrs:{src:e.formData.data.imgStr,alt:""}})]):a("div",[a("img",{staticStyle:{height:"0.5rem"},attrs:{src:"",alt:""}})]),e._v(" "),a("add-signature",{attrs:{title:e.addSignatureTit,queryData:e.searchData},on:{searchPro:e.signature}}),e._v(" "),a("ul",{staticClass:"signature"},[a("el-form-item",{attrs:{label:"工程师"}},[a("div",[e._v(e._s(e.formData.data.engineername))])])],1),e._v(" "),a("div",{staticStyle:{height:"0.6rem"}}),e._v(" "),e.signImg?e._e():a("el-form-item",{staticClass:"serviceSubmitBtn"},[a("el-button",{on:{click:function(t){e.submitForm("formData")}}},[e._v("提交")])],1)],2)],1)])])},staticRenderFns:[]};var C=a("VU/8")(b,T,!1,function(e){a("mT6O"),a("NUIb")},"data-v-e6a18e3e",null).exports,w={name:"onsiteServiceInfo",components:{HeaderLast:a("eMYz").a,beforeWorkConfirm:y,endSummary:S,customerEditRate:C},data:function(){return{onsiteServiceInfoTit:"现场服务单",onsiteServiceInfoTit1:"故障处理服务单",activeName:"first",caseId:this.$route.query.caseId,workId:this.$route.query.workId,serviceId:this.$route.query.serviceId,serviceType:this.$route.query.serviceType,taskId:this.$route.query.taskId}},beforeRouteLeave:function(e,t,a){"serviceList"==e.name&&(e.meta.isUseCache=!1),a()}},$={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"onsiteServiceInfoView"},[2==e.serviceType?a("header-last",{attrs:{title:e.onsiteServiceInfoTit}}):a("header-last",{attrs:{title:e.onsiteServiceInfoTit1}}),e._v(" "),a("div",{staticStyle:{height:"0.45rem"}}),e._v(" "),a("div",{staticClass:"eventShowTabs"},[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"实施前确认",name:"first"}},[a("before-work-confirm")],1),e._v(" "),a("el-tab-pane",{attrs:{label:"完成后总结",name:"second",lazy:""}},[a("end-summary")],1),e._v(" "),a("el-tab-pane",{attrs:{label:"客户评价",name:"third",lazy:""}},[a("customer-edit-rate")],1)],1)],1)],1)},staticRenderFns:[]};var A=a("VU/8")(w,$,!1,function(e){a("o+jF")},"data-v-b3439e2e",null);t.default=A.exports},Zrlr:function(e,t,a){"use strict";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},fHnl:function(e,t){},mT6O:function(e,t){},"o+jF":function(e,t){},wxAW:function(e,t,a){"use strict";t.__esModule=!0;var s,i=a("C4MV"),r=(s=i)&&s.__esModule?s:{default:s};t.default=function(){function e(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),(0,r.default)(e,s.key,s)}}return function(t,a,s){return a&&e(t.prototype,a),s&&e(t,s),t}}()},x5rw:function(e,t){}});