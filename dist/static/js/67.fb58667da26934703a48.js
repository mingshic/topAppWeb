webpackJsonp([67],{Vj5u:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("mvHQ"),o=a.n(s),l=(a("YF26"),a("mtWM"),a("eMYz")),n=a("Z1y9"),i=(a("mw3O"),{name:"casePartEvaluate",components:{headerLast:l.a},data:function(){return{casePartInfoTit:"备件评价",casePersonInfoTit:"人员评价",workId:this.$route.query.workId,caseId:this.$route.query.caseId,templateType:this.$route.query.templateType,bjflg:this.$route.query.bjflg,evaluateId:"",evaluateval:[],evaluateStatus:1,otherResult:"",EvaluateResult:[],evaluateIdReturn:"",submitFlg:"",questionComment:"",engineer:"梁瑛",formData:{name:"",phone:"",region:"",type:"",article:"",email:""}}},mounted:function(){var e=this;n.a.get("?action=/work/GetWorkEvaluateInfo",{CASE_ID:this.caseId,WORK_ID:this.workId,TEMPLATE_TYPE:this.templateType,BJ_FLG:this.bjflg}).then(function(t){if(console.log(t),e.submitFlg=t.SUBMIT_FLG,e.evaluateId=t.EVALUATE_ID_RETURN,"0"==t.STATUSCODE){e.questionComment=t.QUESTION[0].questionComment;var a=[];t.QUESTION.forEach(function(e,t,s){var o={};o.question=e,o.options=e.optionOption,o.chkedopts=o.options.filter(function(e){return e.checkFlg}),o.aroptschked=o.chkedopts.map(function(e,t,a){return e.optionId}),o.scores=e.scoreOption;var l=0;o.scores.forEach(function(e,t,a){1==e.checkFlg&&(l=t+1)}),o.scoreval=l,a.push(o)}),e.evaluateval=a,console.log(a)}})},scoreChange:function(e){},methods:{submitForm:function(){var e=this,t=new Array,a={};if(a.evaluateId=this.evaluateId,a.questionId=this.evaluateval[0].question.questionId,2==this.templateType?a.optionId=this.evaluateval[0].scoreval+12:1==this.templateType&&(a.optionId=this.evaluateval[0].scoreval),t.push(a),this.evaluateval[0].scoreval<4){var s=this.evaluateval[0].aroptschked,l=this.evaluateId,i=this.evaluateval[0].question.questionId,r=this.otherResult;0!=s.length&&s.forEach(function(e,a,s){var o={};o.evaluateId=l,o.questionId=i,o.optionId=e,12==e&&(o.otherResult=r),t.push(o)})}t=o()(t);var u=new URLSearchParams;u.append("totalScore",this.evaluateval[0].scoreval),u.append("failFlg",this.evaluateval[0].scoreval<3?1:0),u.append("EvaluateResult",t),u.append("workId",this.workId),u.append("evaluateId",this.evaluateId),u.append("evaluateStatus",2);var c=this.$loading({lock:!0,text:"提交中...",spinner:"el-icon-loading",background:"rgba(255, 255, 255, 0.3)"});n.a.post("?action=/work/SubmitWorkEvaluateInfo",u).then(function(t){c.close(),"0"==t.STATUSCODE?(e.$message({message:"提交成功",type:"success",center:!0,customClass:"msgdefine",TimeRanges:"1000"}),location.reload):e.$message({message:t.MESSAGE+"发生错误",type:"error",center:!0,customClass:"msgdefine"})})}}}),r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"casePersontEvaluateView"},[2==e.templateType?a("header-last",{attrs:{title:e.casePartInfoTit}}):e._e(),e._v(" "),1==e.templateType?a("header-last",{attrs:{title:e.casePersonInfoTit}}):e._e(),e._v(" "),a("div",{staticStyle:{height:"0.45rem"}}),e._v(" "),a("div",{staticClass:"casePartContent"},[a("div",{staticClass:"questionComment"},[e._v(e._s(e.questionComment))]),e._v(" "),a("el-form",{ref:"formData",attrs:{model:e.formData}},[e._l(e.evaluateval,function(t,s){return a("div",{key:s,staticClass:"editorView"},[a("el-form-item",[a("div",{staticClass:"star"},[a("el-rate",{model:{value:t.scoreval,callback:function(a){e.$set(t,"scoreval",a)},expression:"item.scoreval"}})],1)]),e._v(" "),a("el-form-item",[t.scoreval<4?a("div",{staticClass:"improve"},[a("span",[e._v(e._s(t.question.questionComment2))]),e._v(" "),a("div",{staticClass:"improveCell"},[a("el-checkbox-group",{model:{value:t.aroptschked,callback:function(a){e.$set(t,"aroptschked",a)},expression:"item.aroptschked"}},e._l(t.options,function(t){return a("el-checkbox",{key:t.optionId,attrs:{label:t.optionId}},[e._v(e._s(t.optionComment))])})),e._v(" "),a("el-input",{attrs:{type:"textarea",placeholder:"请填写待改进问题"},model:{value:e.otherResult,callback:function(t){e.otherResult=t},expression:"otherResult"}})],1)]):e._e()])],1)}),e._v(" "),a("el-form-item",{staticClass:"submitBtn1"},[1==e.submitFlg?a("el-button",{on:{click:e.submitForm}},[e._v("提交")]):e._e(),e._v(" "),0==e.submitFlg?a("div",{staticStyle:{"margin-left":"20px"}},[a("p",[e._v("当前评价已提交或不可提交！")])]):e._e()],1)],2)],1)],1)},staticRenderFns:[]};var u=a("VU/8")(i,r,!1,function(e){a("XoO3")},"data-v-34927472",null);t.default=u.exports},XoO3:function(e,t){}});